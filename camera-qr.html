<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>Member Point</title>
    <link rel="manifest" href="/manifest.json">


    <link href="./dist/styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet"> 
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

</head>
<body class="bg-gray-200 text-gray-900 font-sans">
    <header class="bg-white text-black fixed w-full z-10 px-6 py-4 flex justify-between items-center dark:bg-black">
        <img src="/assets/modified-logo.png" alt="" class="w-14">
        <img src="/assets/no-photo.jpg" alt="Profile Picture" class="w-10 h-10 rounded-full border-2 border-black">
    </header>

    <main class="container mx-auto px-6 pb-24 mb-0 w-full">
        <div class="w-full h-full max-w-md max-h-screen bg-gray-800 flex items-center justify-center">
            <p class="fixed top-20 text-sm font-medium text-black text-center z-10 shadow-sm">
                Arahkan barcode ke dalam kotak
                <br>
                Scan barcode hanya jika ditunjukkan kasir
            </p>
            
            <video id="camera-stream" class="absolute inset-0 w-full h-full object-cover" autoplay></video>
    
            <div class="border-4 border-white rounded-lg fixed" style="width: 200px; height: 200px; top: 250px;">
            </div>
        </div>
    
        <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    
        <script>
            // Elemen video untuk menampilkan stream kamera
            const videoElement = document.getElementById("camera-stream");
    
            // Fungsi untuk memulai kamera
            async function startCamera() {
                try {
                    // Meminta izin untuk mengakses kamera
                    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
    
                    // Menyambungkan stream ke elemen video
                    videoElement.srcObject = stream;
    
                    // Pastikan video benar-benar siap untuk diputar
                    videoElement.onloadedmetadata = () => {
                        videoElement.play();
                        
                        // Menginisialisasi pemindaian QR Code dengan html5-qrcode
                        const html5QrCode = new Html5Qrcode("camera-stream");
    
                        // Fungsi untuk menangani hasil pemindaian QR Code
                        function onScanSuccess(decodedText, decodedResult) {
                            console.log(`QR Code detected: ${decodedText}`);
                            // Anda bisa melakukan sesuatu dengan hasil QR code seperti redirect atau proses data lebih lanjut
                        }
    
                        // Fungsi untuk menangani kesalahan pemindaian
                        function onScanFailure(error) {
                            console.warn(`Scan failed: ${error}`);
                        }
    
                        // Mulai pemindaian QR Code setelah kamera siap
                        html5QrCode.start(
                            { facingMode: "environment" },  // Menggunakan kamera belakang
                            { fps: 10, qrbox: 250 },        // FPS dan ukuran box untuk pemindaian
                            onScanSuccess,
                            onScanFailure
                        ).catch((err) => {
                            console.error("Error starting QR scanner: " + err);
                        });
                    };
                } catch (error) {
                    console.error("Tidak dapat mengakses kamera. Periksa izin atau perangkat Anda.");
                    alert("Tidak dapat mengakses kamera. Periksa izin atau perangkat Anda.");
                }
            }
    
            // Menjalankan fungsi startCamera setelah halaman dimuat sepenuhnya
            window.onload = startCamera;
        </script>
    </main>
        
    
    
    <footer class="bg-white text-black p-2 fixed bottom-0 left-0 w-full z-10 border-t border-gray-300">
        <nav class="flex justify-center">
            <a href="/index.html" class="mx-1 w-[80px] bg-white text-gray-400 p-2 rounded-lg flex-row text-center">
                <i class="fas fa-home text-lg"></i>
                <p class="text-sm font-sans font-medium truncate">Beranda</p>
            </a>

            <a href="/point.html" class="mr-8 w-[80px] bg-white text-gray-400 p-2 rounded-lg flex-row text-center">
                <i class="fas fa-bag-shopping text-lg"></i>
                <p class="text-sm font-sans font-medium truncate">Poin</p>
            </a>

            <a href="#" class="w-[60px] h-[60px] bg-yellow-300 text-black p-2 border-4 border-white rounded-xl fixed bottom-8 flex justify-center items-center text-center">
                <i class="fas fa-qrcode text-3xl"></i>
            </a>

            <a href="#" class="ml-8 w-[80px] bg-white text-gray-400 p-2 rounded-lg flex-row text-center">
                <i class="fas fa-clock-rotate-left text-lg"></i>
                <p class="text-sm font-sans font-medium truncate">Riwayat</p>
            </a>
            <a href="#" class="mx-1 w-[80px] bg-white text-gray-400 p-2 rounded-lg flex-row text-center">
                <i class="fas fa-gear text-lg"></i>
                <p class="text-sm font-sans font-medium truncate">Pengaturan</p>
            </a>
        </nav>
    </footer>
    
</body>
</html>